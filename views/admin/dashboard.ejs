<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="icon" href="/adminTitleIcon/Gemini_Generated_Image_19c76t19c76t19c7.png" type="image/png">
    <style>
        :root {
            --primary-yellow: #FFD700;
            --light-yellow: #FFF9C4;
            --dark-yellow: #E6C200;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --text-dark: #333333;
            --text-light: #666666;
            --border-color: #e0e0e0;
            --return-color: #ea4335;
            --cancel-color: #fbbc04;
            --success-color: #34A853;
        }

        body {
            background-color: #fefefe;
            color: var(--text-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            transition: all 0.3s ease;
            max-width: 1200px;
            margin: 70px auto;
            margin-left: 250px;
        }

        /* Header Styles */
        .header {
            background: var(--white);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-yellow);
            margin-bottom: 20px;
        }

        .header h1 {
            color: var(--text-dark);
            font-weight: 700;
            margin: 0;
        }

        /* Summary Cards */
        .summary-card {
            background: var(--white);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--primary-yellow);
            transition: transform 0.3s ease;
            height: 100%;
        }

        .summary-card:hover {
            transform: translateY(-5px);
        }

        .summary-card h3 {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .summary-card .value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        /* Filters Section */
        .filters {
            background: var(--white);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-yellow);
            margin-bottom: 20px;
        }

        /* Button Styles */
        .btn-yellow {
            background: var(--primary-yellow);
            color: var(--text-dark);
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .btn-yellow:hover {
            background: var(--dark-yellow);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-outline-yellow {
            background: transparent;
            border: 1px solid var(--primary-yellow);
            color: var(--text-dark);
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .btn-outline-yellow:hover {
            background: var(--light-yellow);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Report Section */
        .report {
            background: var(--white);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-yellow);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .report-header h2 {
            color: var(--text-dark);
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }

        /* Additional Charts Container */
        .additional-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Filter Buttons */
        #filterButtons .btn {
            transition: all 0.25s ease-in-out;
            border-radius: 6px;
        }

        #filterButtons .btn:hover {
            transform: translateY(-2px);
        }

        .custom-inputs {
            transition: opacity 0.3s ease;
        }

        .custom-inputs input {
            border-radius: 6px;
        }

        #applyCustomFilter {
            transition: all 0.2s ease-in-out;
            border-radius: 6px;
        }

        #applyCustomFilter:hover {
            transform: scale(1.05);
        }

        /* Responsive Styles */
        @media (max-width: 1200px) {
            .additional-charts {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .main-content {
                padding: 15px;
            }
            
            .date-range {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .report-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .report-header .action-buttons {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 10px;
            }
            
            .summary-card .value {
                font-size: 20px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            #filterButtons .btn {
                padding: 8px 12px;
                font-size: 14px;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <!-- Include Admin Header Partial -->
    <%- include('../../views/partials/admin/adminHeaders', {title: 'adminHeader-page' }) %>
    <%- include('../../views/partials/admin/adminSidebar', {title: 'adminSidebar-page' }) %>

    <div class="dashboard-container">        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header d-flex justify-content-between align-items-center">
                <h1>Dashboard</h1>
            </div>

            <!-- Filter Reports Section -->
            <div class="text-center my-4">
                <h5 class="mb-3 fw-bold">Filter Reports</h5>

                <!-- Filter Buttons -->
                <div id="filterButtons" class="btn-group mb-3 flex-wrap" role="group" aria-label="Report Filters">
                    <button type="button" class="btn btn-outline-yellow" data-filter="daily">Daily</button>
                    <button type="button" class="btn btn-outline-yellow" data-filter="weekly">Weekly</button>
                    <button type="button" class="btn btn-outline-yellow" data-filter="monthly">Monthly</button>
                    <button type="button" class="btn btn-outline-yellow" data-filter="yearly">Yearly</button>
                    <button type="button" class="btn btn-outline-yellow" data-filter="custom">Custom</button>
                </div>

                <!-- Custom Date Inputs -->
                <div id="customDateInputs" class="custom-inputs mt-3" style="display: none;">
                    <div class="d-flex flex-column flex-md-row align-items-center gap-2 justify-content-center">
                        <input type="date" id="startDate" class="form-control w-auto">
                        <span class="d-none d-md-block">to</span>
                        <input type="date" id="endDate" class="form-control w-auto">
                        <button id="applyCustomFilter" class="btn btn-yellow mt-2 mt-md-0">Apply</button>
                    </div>
                </div>
            </div>

            <!-- Additional Charts for Top Selling Products and Categories -->
            <div class="additional-charts">
                <div class="report">
                    <div class="report-header">
                        <h2>Top Selling Products</h2>
                    </div>
                    <div class="chart-container">
                        <% if (topProducts && topProducts.length> 0) { %>
                            <canvas id="productsChart"></canvas>
                            <% } else { %>
                                <div class="d-flex justify-content-center align-items-center h-100">
                                    <p class="text-muted">No Data Available</p>
                                </div>
                                <% } %>
                    </div>
                </div>

                <div class="report">
                    <div class="report-header">
                        <h2>Sales by Category</h2>
                    </div>
                    <div class="chart-container">
                        <% if (topCategory && topCategory.length> 0) { %>
                            <canvas id="categoriesChart"></canvas>
                            <% } else { %>
                                <div class="d-flex justify-content-center align-items-center h-100">
                                    <p class="text-muted">No Data Available</p>
                                </div>
                                <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize charts based on available data
            <% if (topProducts && topProducts.length > 0) { %>
                initializeProductsChart();
            <% } %>
            
            <% if (topCategory && topCategory.length > 0) { %>
                initializeCategoriesChart();
            <% } %>
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize date inputs with current date
            const today = new Date();
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(today.getDate() - 7);
            
            document.getElementById('startDate').valueAsDate = sevenDaysAgo;
            document.getElementById('endDate').valueAsDate = today;
        });

        // Chart initialization functions
        function initializeProductsChart() {
            const productsCtx = document.getElementById('productsChart').getContext('2d');
            
            new Chart(productsCtx, {
                type: 'bar',
                data: {
                    labels: <%- JSON.stringify(topProducts.map((p) => p.productName)) %>,
                    datasets: [
                        {
                            label: 'Units Sold',
                            data: <%- JSON.stringify(topProducts.map((p) => p.totalSold)) %>,
                            backgroundColor: 'rgba(255, 215, 0, 0.7)',
                            borderColor: 'rgba(255, 193, 7, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Revenue',
                            data: <%- JSON.stringify(topProducts.map((p) => p.totalRevenue)) %>,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top Selling Products (Units vs Revenue)',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Units Sold' }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'Revenue (₹)' }
                        }
                    }
                }
            });
        }

        function initializeCategoriesChart() {
            const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
            
            new Chart(categoriesCtx, {
                type: 'doughnut',
                data: {
                    labels: <%- JSON.stringify(topCategory.map((c) => c.categoryName)) %>,
                    datasets: [{
                        label: 'Total Sold',
                        data: <%- JSON.stringify(topCategory.map((c) => c.totalSold)) %>,
                        backgroundColor: [
                            'rgba(255, 215, 0, 0.7)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(255, 152, 0, 0.7)',
                            'rgba(255, 87, 34, 0.7)',
                            'rgba(121, 85, 72, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 215, 0, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(255, 152, 0, 1)',
                            'rgba(255, 87, 34, 1)',
                            'rgba(121, 85, 72, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sales Distribution by Category',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const sold = context.raw.toLocaleString('en-IN');
                                    const revenue = <%- JSON.stringify(topCategory.map((c) => c.totalRevenue)) %>[index].toLocaleString('en-IN');
                                    return `Sold: ${sold} | Revenue: ₹${revenue}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Event listener setup
        function setupEventListeners() {
            // Filter buttons
            const filterButtons = document.querySelectorAll('#filterButtons button');
            const customDateInputs = document.getElementById('customDateInputs');
            const applyButton = document.getElementById('applyCustomFilter');
            let filterDate;
            
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterDate = button.dataset.filter;
                    
                    // Remove active class from all
                    filterButtons.forEach(btn => {
                        btn.classList.remove('btn-yellow', 'text-dark');
                        btn.classList.add('btn-outline-yellow');
                    });
                    
                    // Activate clicked one
                    button.classList.remove('btn-outline-yellow');
                    button.classList.add('btn-yellow', 'text-dark');
                    
                    // Show or hide custom date section
                    if (button.dataset.filter === 'custom') {
                        customDateInputs.style.display = 'block';
                        customDateInputs.style.opacity = 0;
                        setTimeout(() => {
                            customDateInputs.style.opacity = 1;
                        }, 50);
                    } else {
                        fetchTheFilterData(filterDate);
                        customDateInputs.style.opacity = 0;
                        setTimeout(() => {
                            customDateInputs.style.display = 'none';
                        }, 300);
                    }
                });
            });
            
            // Apply custom filter
            applyButton.addEventListener('click', () => {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                if (!startDate || !endDate) {
                    showToast('Please select both start and end dates.', 'error');
                    return;
                }
                
                fetchTheFilterData(startDate, endDate);
            });
        }
        
        // Helper functions
        function fetchTheFilterData(...date) {
            // Show loading state
            document.body.classList.add('loading');
            
            // In a real application, this would be an API call or form submission
            setTimeout(() => {
                window.location.href = `/admin/dashboard?date=${encodeURIComponent(date)}`;
            }, 500);
        }
        
        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `alert alert-${type === 'error' ? 'danger' : 'success'} alert-dismissible fade show position-fixed`;
            toast.style.top = '20px';
            toast.style.right = '20px';
            toast.style.zIndex = '9999';
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000)
        }
    </script>
</body>
</html>